# check if Doxygen is installed. if it's not found, let the user know, then don't bother with the
# build target for the reference manual.
find_program(doxygen "doxygen")
if (doxygen STREQUAL "doxygen-NOTFOUND")
    message(WARNING "Doxygen was not found. The build target 'reference' will not be available.")
    return()
endif()

# check if pdflatex is installed. if it is, enable LaTeX output. if it is not, give a warning and
# disable LaTeX output.
find_program(pdflatex "pdflatex")
if (pdflatex STREQUAL "pdflatex-NOTFOUND")
    message(WARNING "Pdflatex was not found. The build target 'reference' will not generate LaTeX output")
    set(generate_latex "no")
else()
    set(generate_latex "yes")
endif()

# add commands to generate Doxygen as a make target
configure_file(doxyfile.in doxyfile)

# add the "reference" target to generate the code reference manual:
# 1) run Doxygen
# 2) if generate_latex is on, run the makefile generated by Doxygen to finish the LaTeX manual
add_custom_target(reference
    COMMAND doxygen
    COMMAND $<$<STREQUAL:"${generate_latex}","yes">:make>
            $<$<STREQUAL:"${generate_latex}","yes">:--directory=latex>
    COMMENT "Running Doxygen..."
    VERBATIM)
